(function(k){function l(b,a,g){var m=0,e=[];g=jQuery.makeArray(g||b.querySelectorAll(a.itemSelector));var n=g.length;b=b.clientWidth-parseFloat(k(b).css("padding-left"))-parseFloat(k(b).css("padding-right"));for(var r=[],d,f=0;f<n;++f)(d=g[f].getElementsByTagName("img")[0])?r[f]={width:parseInt(d.getAttribute("width"))||d.offsetWidth,height:parseInt(d.getAttribute("height"))||d.offsetHeight}:(g.splice(f,1),--f,--n);n=g.length;for(d=0;d<n;++d){g[d].classList?g[d].classList.remove(a.firstItemClass,
a.lastRowClass):g[d].className=g[d].className.replace(new RegExp("(^|\\b)"+a.firstItemClass+"|"+a.lastRowClass+"(\\b|$)","gi")," ");m+=r[d].width;e.push(g[d]);if(d===n-1)for(var c=0;c<e.length;c++)0===c&&(e[c].className+=" "+a.lastRowClass),e[c].style.cssText="margin-right:"+(c<e.length-1?a.minMargin+"px":0);if(m+a.maxMargin*(e.length-1)>b){f=m+a.maxMargin*(e.length-1)-b;c=e.length;if((a.maxMargin-a.minMargin)*(c-1)<f)var l=a.minMargin,f=f-(a.maxMargin-a.minMargin)*(c-1);else l=a.maxMargin-f/(c-1),
f=0;for(var s,p=0,c=0;c<e.length;c++){s=e[c];var q=r[d+parseInt(c)-e.length+1].width,h=q-q/m*f,q=Math.round(r[d+parseInt(c)-e.length+1].height*(h/q));.5<=p+1-h%1?(p-=h%1,h=Math.floor(h)):(p+=1-h%1,h=Math.ceil(h));s.style.cssText="width: "+h+"px;height: "+q+"px;margin-right: "+(c<e.length-1?l:0)+"px";0===c&&(s.className+=" "+a.firstItemClass)}e=[];m=0}}}k.fn.rowGrid=function(b){return this.each(function(){$this=k(this);if("appended"===b){b=$this.data("grid-options");var a=$this.children("."+b.lastRowClass),
a=a.nextAll(b.itemSelector).add(a);l(this,b,a)}else if(b=k.extend({},k.fn.rowGrid.defaults,b),$this.data("grid-options",b),l(this,b),b.resize)k(window).on("resize.rowGrid",{container:this},function(a){l(a.data.container,b)})})};k.fn.rowGrid.defaults={minMargin:null,maxMargin:null,resize:!0,lastRowClass:"last-row",firstItemClass:null}})(jQuery);